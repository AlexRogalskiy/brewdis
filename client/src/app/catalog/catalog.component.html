<form (ngSubmit)="search(0,50)" class="search-form">
	<div fxLayout.xs="column" fxLayout="row wrap" fxLayoutGap="10px" ngClass.gt-xs="ml-10">
		<mat-form-field fxFlex.sm="0 1 calc(50%-10px)" fxFlex.md="0 1 calc(33%-10px)" fxFlex.gt-md="0 1 calc(20%-10px)">
			<mat-label>Category</mat-label>
			<mat-select [formControl]="categoryField">
				<mat-option *ngFor="let category of categories" [value]="category.id">{{category.name}}</mat-option>
			</mat-select>
		</mat-form-field>
		<mat-form-field fxFlex.sm="0 1 calc(50%-10px)" fxFlex.md="0 1 calc(33%-10px)" fxFlex.gt-md="0 1 calc(20%-10px)">
			<mat-label>Style</mat-label>
			<mat-select [formControl]="styleField">
				<mat-option *ngFor="let style of styles" [value]="style.id">{{style.name}}</mat-option>
			</mat-select>
		</mat-form-field>
		<mat-form-field hintLabel="Type a few characters" fxFlex.sm="0 1 calc(50%-10px)" fxFlex.md="0 1 calc(33%-10px)"
			fxFlex.gt-md="0 1 calc(25%-10px)">
			<input matInput placeholder="Brewery" aria-label="Brewery" [matAutocomplete]="auto"
				[formControl]="breweryField">
			<mat-autocomplete #auto="matAutocomplete" [displayWith]="displayBrewery"
				(optionSelected)='brewerySelected($event.option.value)'>
				<mat-option *ngFor="let brewery of breweries" [value]="brewery">
					<img class="brewery-img" aria-hidden [src]="brewery.icon" height="25">
					<span>{{brewery.name}}</span>
				</mat-option>
			</mat-autocomplete>
		</mat-form-field>
		<mat-form-field fxFlex.sm="0 1 calc(33%-10px)" fxFlex.md="0 1 calc(25%-10px)" fxFlex.gt-md="0 1 calc(7%-10px)">
			<mat-label>ABV</mat-label>
			<mat-select [formControl]="abvField">
				<mat-option value="0-3">0 - 3%</mat-option>
				<mat-option value="3-5">3 - 5%</mat-option>
				<mat-option value="5-7">5 - 7%</mat-option>
				<mat-option value="7-9">7 - 9%</mat-option>
				<mat-option value="9-11">9 - 11%</mat-option>
				<mat-option value="11-15">11 - 15%</mat-option>
				<mat-option value="15-100">> 15%</mat-option>
			</mat-select>
		</mat-form-field>
		<mat-form-field fxFlex.sm="0 1 calc(33%-10px)" fxFlex.md="0 1 calc(25%-10px)" fxFlex.gt-md="0 1 calc(8%-10px)">
			<mat-label>IBU</mat-label>
			<mat-select [formControl]="ibuField">
				<mat-option value="0-10">0 - 10</mat-option>
				<mat-option value="10-20">10 - 20</mat-option>
				<mat-option value="20-30">20 - 30</mat-option>
				<mat-option value="30-50">30 - 50</mat-option>
				<mat-option value="50-90">50 - 90</mat-option>
				<mat-option value="90-120">90 - 120</mat-option>
				<mat-option value="120-inf">> 120</mat-option>
			</mat-select>
		</mat-form-field>
		<mat-form-field hintLabel="RediSearch query" fxFlex.sm="0 1 calc(100%-10px)" fxFlex.md="0 1 calc(80%-10px)"
			fxFlex.gt-md="0 1 calc(60%-10px)">
			<input matInput placeholder="Query" [formControl]="searchField">
		</mat-form-field>
		<mat-form-field fxFlex.sm="0 1 calc(25%-10px)" fxFlex.md="0 1 calc(10%-10px)" fxFlex.gt-md="0 1 calc(5%-10px)">
			<mat-label>Sort by</mat-label>
			<mat-select [(value)]="sortByField">
				<mat-option value="name">Beer Name</mat-option>
				<mat-option value="abv">ABV</mat-option>
				<mat-option value="ibu">IBU</mat-option>
			</mat-select>
		</mat-form-field>
		<mat-form-field fxFlex.sm="0 1 calc(25%-10px)" fxFlex.md="0 1 calc(10%-10px)" fxFlex.gt-md="0 1 calc(5%-10px)">
			<mat-select [(value)]="sortByDirection">
				<mat-option value="Ascending">Ascending</mat-option>
				<mat-option value="Descending">Descending</mat-option>
			</mat-select>
		</mat-form-field>
		<button mat-raised-button color="primary" type="submit" class="submit">Submit</button>
	</div>
</form>

<div fxLayout="row" class="paginator">
	<mat-paginator [length]="length" [pageIndex]="pageIndex" [pageSize]="pageSize" [pageSizeOptions]="[10, 50, 100]"
		(page)="handlePage($event)">
	</mat-paginator>
	<div class="mat-paginator">
		<div class="mat-paginator-outer-container">
			<div class="mat-paginator-container">
				<div class="duration" *ngIf="results | async as results">{{results.duration | number}} seconds</div>
			</div>
		</div>
	</div>
</div>

<div *ngIf="(results | async) as results">
	<div fxLayout.xs="column" fxLayout="row wrap" fxLayoutGap="10px" ngClass.gt-xs="ml-10">
		<mat-card *ngFor="let product of results.results" fxFlex.sm="0 1 calc(50%-10px)" fxFlex.md="0 1 calc(33%-10px)"
			fxFlex.gt-md="0 1 calc(20%-10px)">
			<mat-card-title [innerHTML]="product.name"></mat-card-title>
			<mat-card-subtitle>
				<span [innerHTML]="product.breweryName"></span>
				<span> • </span>
				<span>{{product.abv ? product.abv : '?'}}%</span>
				<span> • </span>
				<span>IBU: {{product.ibu ? product.ibu : '?'}}</span>
			</mat-card-subtitle>
			<img mat-card-image
				src="{{ product.hasOwnProperty('labels.medium') ? product['labels.medium'] : 'assets/brewdis.svg' }}"
				class="image">
			<mat-card-actions>
				<button mat-button (click)="openDescriptionDialog(product)" color="basic">Details</button>
				<button mat-button [routerLink]="['/availability', product.sku]" color="primary">Availability</button>
			</mat-card-actions>
		</mat-card>
	</div>
</div>