= Real-Time Inventory
:revnumber: {project-version}
ifndef::imagesdir[:imagesdir: images]

== Introduction

[%step]
* What is retail inventory?
* Real-time inventory architecture
* Demo

== Retail Inventory

*What* is available *Where*

[%step]
* *What:* Products
* *Where:* Stores and DCs

[NOTE.speaker]
--
* A product might have many SKUs (the same shirt has different SKUs for size/color/style combinations). Some retailers reference 1M+ SKUs
* Distribution Center AKA Fulfillment Center AKA Warehouse
--

== Inventory Consumers

[%step]
* e-Commerce
* Find/Reserve in Store
* Order Sourcing
* Store Allocation

== Item Availability

[%step]
* Buckets for supply & demand tracking
* What's really available?
* *Available to Promise (ATP)*: Supply - Demand

[NOTE.speaker]
--
* How do we decide if we can show a piece of inventory as available on the website?
* Factors: on hand (actual inventory), price, product, store, sales velocity, cost to fulfill, order status, laws and regulations, location
--

== Inventory Challenges

[%step]
** Volume
** Velocity
** Geo-Distribution

[NOTE.speaker]
--
* Volume: 1000 Stores * 100,1000 SKUS => 100M Store/SKU combinations
* Velocity: 1000s inventory updates/sec
* Geo-Distribution: maintain consistency between store(s) and data centers
--

== Real-Time Inventory Architecture

image::inventory-architecture.svg[]

== Retail Inventory Demo

[%step]
* Brewdis: beer retailer
* 3500 Stores worldwide
* 30,000 SKUs

== Stores Index

[%step]
* `store:<id>`
* `id`: tag field
* `name`: text field
* `location`: geo field
* ...

== Products Index

[%step]
* `product:<sku>`
* `sku`: tag field
* `name`: text field
* ...

== Inventory Index

[%step]
* `inventory:<store>:<sku>`
* `store`: tag field
* `sku`: tag field
* `location`: geo field
* `availableToPromise`: numeric field
* ...

== Demo Architecture

image::brewdis-architecture.svg[]


== Inventory Generator

`XADD inventory-update-stream * store 7 sku B5 allocated 4`

== Inventory Manager

[source,plaintext]
----
XREAD STREAMS inventory-updates

=> FT.GET inventory inventory:7:B5

=> FT.ADD inventory inventory:7:B5 1.0 FIELDS atp 20 allocated 16

=> XADD inventory-stream * id 7:B5 atp 20 allocated 16
----

== Querying Inventory

Availability lookup

`FT.GET inventory inventory:7:B5`

== Querying Inventory

Local availability

`FT.SEARCH inventory "@location:{-118.2 34.0 10 mi}"`

== Querying Inventory

Regional availability levels

`FT.AGGREGATE inventory "@sku:{02 93 13} @location:[-118.2 34.0 25 mi]" GROUPBY 1 @sku REDUCE SUM 1 @atp AS atp SORTBY 2 @atp DESC`